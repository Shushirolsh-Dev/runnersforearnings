<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Runner Login • SDEL</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = { theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] } } } }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body { margin:0; overflow:hidden; background:#000; height:100vh; position:relative; }
    .stars { position:fixed; inset:0; pointer-events:none; z-index:1; }
    .star { 
      position:absolute; 
      background:#fff; 
      border-radius:50%; 
      opacity:0; 
      animation:fall linear forwards; 
    }
    @keyframes fall { 
      0% { opacity:1; transform:translateY(-10px); }
      100% { opacity:0; transform:translateY(100vh) rotate(360deg); }
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">

  <!-- FALLING STARS BACKGROUND -->
  <div class="stars" id="stars"></div>

  <!-- LOGIN CARD – ORANGE ACCENTS -->
  <div class="relative z-10 bg-black/95 backdrop-blur-2xl rounded-3xl p-10 w-full max-w-md border-2 border-orange-600/40 shadow-2xl shadow-orange-600/20">
    
    <div class="text-center mb-10">
      <h1 class="text-5xl font-black bg-gradient-to-r from-orange-400 via-orange-500 to-amber-500 bg-clip-text text-transparent">
        SDEL Runner
      </h1>
      <p class="text-gray-400 mt-3 text-lg">Login to your dashboard</p>
    </div>

    <form id="loginForm" class="space-y-7">
      <!-- Email -->
      <div>
        <input 
          type="email" 
          id="email" 
          placeholder="Enter your email" 
          required
          class="w-full px-6 py-5 bg-gray-900/70 rounded-2xl border border-orange-600/50 focus:border-orange-500 outline-none text-lg placeholder-gray-500 transition"
        />
      </div>

      <!-- Password + Eye -->
      <div class="relative">
        <input 
          type="password" 
          id="password" 
          placeholder="Enter password" 
          required
          class="w-full px-6 py-5 bg-gray-900/70 rounded-2xl border border-orange-600/50 focus:border-orange-500 outline-none text-lg placeholder-gray-500 pr-14 transition"
        />
        <button 
          type="button" 
          id="togglePass" 
          class="absolute right-5 top-1/2 -translate-y-1/2 text-orange-400 text-2xl hover:text-orange-300 transition">
          Show
        </button>
      </div>

      <!-- Login Button -->
      <button 
        type="submit"
        class="w-full py-5 bg-gradient-to-r from-orange-500 to-amber-600 rounded-2xl font-bold text-xl text-white hover:from-orange-600 hover:to-amber-700 transform hover:scale-105 transition duration-200 shadow-lg">
        Login as Runner
      </button>
    </form>

    <!-- Forgot Password -->
    <div class="text-center mt-6">
      <button onclick="forgotPassword()" class="text-orange-400 hover:text-orange-300 text-sm font-medium underline underline-offset-2">
        Forgot Password?
      </button>
    </div>

    <!-- Messages -->
    <div id="error" class="mt-6 text-red-400 text-center font-semibold hidden"></div>
    <div id="loading" class="mt-6 text-orange-400 text-center font-medium hidden">
      Verifying runner access...
    </div>
  </div>

  <script>
    // === YOUR SUPABASE CREDENTIALS ===
    const supabaseUrl = 'https://YOUR-PROJECT.supabase.co';
    const supabaseKey = 'your-anon-key-here';
    const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

    // FALLING STARS – Fixed & Beautiful
    setInterval(() => {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.width = star.style.height = Math.random() * 3 + 2 + 'px';
      star.style.left = Math.random() * 100 + 'vw';
      star.style.top = '-10px';
      star.style.animationDuration = Math.random() * 3 + 3 + 's';
      document.getElementById('stars').appendChild(star);
      setTimeout(() => star.remove(), 8000);
    }, 150);

    // Toggle Password Visibility
    document.getElementById('togglePass').onclick = () => {
      const pass = document.getElementById('password');
      const btn = document.getElementById('togglePass');
      if (pass.type === 'password') {
        pass.type = 'text';
        btn.textContent = 'Hide';
      } else {
        pass.type = 'password';
        btn.textContent = 'Show';
      }
    };

    // Login Form
    document.getElementById('loginForm').onsubmit = async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const errorEl = document.getElementById('error');
      const loadingEl = document.getElementById('loading');

      errorEl.classList.add('hidden');
      loadingEl.classList.remove('hidden');

      try {
        // 1. Login with email + password
        const { data, error } = await supabase.auth.signInWithPassword({
          email,
          password
        });

        if (error) throw error;

        // 2. STRICT CHECK: Must be a runner
        const { data: profile, error: profileError } = await supabase
          .from('profiles')
          .select('role, full_name')
          .eq('id', data.user.id)
          .single();

        if (profileError || !profile) throw new Error('Profile not found');
        if (profile.role !== 'runner') {
          await supabase.auth.signOut();
          throw new Error('Access denied. Only registered runners can login here.');
        }

        // Success
        loadingEl.textContent = `Welcome back, ${profile.full_name.split(' ')[0]}!`;
        setTimeout(() => {
          location.href = 'runner.html';
        }, 1000);

      } catch (err) {
        loadingEl.classList.add('hidden');
        errorEl.textContent = err.message;
        errorEl.classList.remove('hidden');
      }
    };

    // Forgot Password
    function forgotPassword() {
      const email = prompt('Enter your registered email:');
      if (email) {
        supabase.auth.resetPasswordForEmail(email, {
          redirectTo: location.origin + '/runner-login.html'
        }).then(({ error }) => {
          if (error) alert('Error: ' + error.message);
          else alert('Password reset link sent to your email!');
        });
      }
    }
  </script>
</body>
</html>
